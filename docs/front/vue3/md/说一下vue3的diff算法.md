# 说一下vue3的diff算法

Vue 3 的 diff 算法称为 `hoisted patch flags` 算法，与 Vue 2 的 diff 算法相比，它的主要优势在于减少了不必要的虚拟 DOM 对比，提高了性能。
## 这段文本描述的是 Vue3 中的 Virtual DOM 更新过程，主要包括两个阶段：标记阶段和更新阶段。

1. 首先从根组件开始递归遍历整个组件树，同时将当前组件的 `patch flag` 标记为未知（`unknown`）状态。

2. 对于每个组件，如果它的子组件中存在动态内容（例如 v-if、v-for、v-slot 等），则将它的 `patch flag` 标记为需要更新（`dynamic`）状态。

3. 对于每个组件，如果它的属性存在动态内容（例如 :class、:style 等），则将它的 `patch flag` 标记为需要更新（``dynamic``）状态。

4. 对于每个组件，如果它的子组件存在静态内容，则将它的 `patch flag` 标记为需要更新（`full`）状态。

5. 对于每个组件，如果它的属性存在静态内容，则将它的 `patch flag` 标记为需要更新（`full`）状态。

6. 标记完所有组件的 `patch flag` 后，从根组件开始递归遍历整个组件树，对每个组件进行更新。

7. 如果当前组件的 `patch flag` 为未知状态，则说明该组件没有任何动态内容或静态内容，直接跳过。

8. 如果当前组件的 `patch flag` 为需要更新状态，则说明该组件存在动态内容或属性，需要对比子组件和属性的变化，并进行更新。

9. 如果当前组件的 `patch flag` 为需要更新状态，则遍历该组件的子组件和属性，将其与前一个状态进行比较，找出变化的部分并进行更新。

10. 如果当前组件的 `patch flag` 为需要更新状态，更新完子组件和属性后，将其 `patch flag` 标记为已更新（handled）状态。

11. 如果当前组件的 `patch flag` 为需要更新状态，但是子组件和属性没有任何变化，则将其 `patch flag` 标记为无需更新（static）状态。

12. 如果当前组件的 `patch flag` 为需要更新状态，但是子组件和属性中存在部分变化，且该组件存在缓存（keep-alive）时，则将其 patch flag 标记为需要更新（`dynamic`）状态，以便下次更新时可以重新比较。